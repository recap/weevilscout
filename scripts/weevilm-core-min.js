var id="";var dtime=0;var cjobs=0;id=randomUUID();window.onbeforeunload=function(){if(id!=""){var a=new XMLHttpRequest();a.open("GET","cgi-bin/loader.cgi?cmd=end&id="+id,false);a.send(null)}};function getFunctionParamList(c){var b=/weevil_main[\s]*\([\w\,\s]+\)/;var f=/\([\w\,\s]+\)/;if(c.match(b)){var g=new String(c.match(b)[0]);var e=new String(g.match(f));var d=e.substr(1,e.length-2);var a=d.split(",");for(i=0;i<a.length;i++){a[i]=a[i].replace(/^\s+|\s+$/g,"")}return a}return[]}function getWeevilList(){var a=GetHttpRequest();var b;a.open("GET","cgi-bin/loader.cgi?cmd=getstore&id="+id,false);a.send(null);if(a.status==200){b=StringtoXML(a.responseText)}return b}function joinWeevilNetwork(){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(success)}var c=new Worker("scripts/grabber.js");var b;var a=/^[-+]?\d+(\.\d+){1}$/;var d=/^[-+]?\d+$/;c.addEventListener("message",function(m){var p=StringtoXML(m.data);b=new Object();var j;var g;var o=p.getElementsByTagName("source")[0].childNodes[0].nodeValue;var f=p.getElementsByTagName("job-id")[0].childNodes[0].nodeValue;var h=p.getElementsByTagName("name")[0].childNodes[0].nodeValue;var l=p.getElementsByTagName("parameters")[0].childNodes;for(k=0;k<l.length;k++){if(!l[k].nodeName.match("#text")){if(l[k].firstChild.nodeValue.match(d)){b[l[k].nodeName]=parseInt(l[k].firstChild.nodeValue)}else{if(l[k].firstChild.nodeValue.match(a)){b[l[k].nodeName]=parseFloat(l[k].firstChild.nodeValue)}else{b[l[k].nodeName]=(l[k].firstChild.nodeValue!="null")?l[k].firstChild.nodeValue:null}}}}var n=new Worker(o);n.onerror=function(u){var s=u.filename.substring(u.filename.lastIndexOf("/")+1,u.filename.length-3);var t="cmd=submit&job_id="+encodeURIComponent(f)+"&job_name="+s+"&id="+encodeURIComponent(id)+"&status=3&result="+encodeURIComponent("[Error] "+u.message);var r=new GetHttpRequest();r.open("POST","cgi-bin/loader.cgi",false);r.setRequestHeader("Content-type","application/x-www-form-urlencoded");r.setRequestHeader("Content-length",l.length);r.setRequestHeader("Connection","close");r.send(t);c.postMessage({id:id});n.postMessage({cmd:"stop"});g=new Date();var q=Math.abs(g-j);dtime=dtime+q;swapDivText("tstate","Idling");swapDivText("dtime",(dtime/1000)+"s")};n.addEventListener("message",function(t){var s="cmd=submit&job_id="+encodeURIComponent(f)+"&job_name="+h+"&id="+encodeURIComponent(id)+"&status=2&result="+encodeURIComponent(t.data);var r=new GetHttpRequest();r.open("POST","cgi-bin/loader.cgi",false);r.setRequestHeader("Content-type","application/x-www-form-urlencoded");r.setRequestHeader("Content-length",l.length);r.setRequestHeader("Connection","close");r.send(s);c.postMessage({id:id});n.postMessage({cmd:"stop"});g=new Date();var q=Math.abs(g-j);dtime=dtime+q;cjobs=cjobs+1;swapDivText("tstate","Idling");swapDivText("cjobs",cjobs);swapDivText("dtime",(dtime/1000)+"s")},false);b.cmd="start";j=new Date();n.postMessage(b);swapDivText("tstate","Working")},false);c.postMessage({id:id})}function enqueueWeevil(c){var a=GetHttpRequest();var b="cmd=enqueue&id="+id+"&weevil="+encodeURIComponent(c);a.open("POST","cgi-bin/loader.cgi",false);a.setRequestHeader("Content-type","application/x-www-form-urlencoded");a.setRequestHeader("Content-length",b.length);a.setRequestHeader("Connection","close");a.send(b)}function success(e){var h=e.coords.latitude;var d=e.coords.longitude;var b=new Worker("scripts/heartbeat.js");var c=setInterval(f,30000);b.addEventListener("message",function(p){var o=StringtoXML(p.data);var n=o.getElementsByTagName("csize")[0].childNodes[0].nodeValue;swapDivText("csize",n);var m=o.getElementsByTagName("flops")[0].childNodes[0].nodeValue;swapDivText("flops",m);o=null},false);function f(){b.postMessage({id:id,lat:h,log:d,flops:l})}var j=new Worker("scripts/flopsCalc-min.js");var a=0;var g=new Array();var l=0;j.addEventListener("message",function(m){g[a]=m.data.flops;a++;if(a<3){j.postMessage({cmd:"start"})}else{j.postMessage({cmd:"stop"});l=(g[0]+g[1]+g[2])/3;b.postMessage({id:id,lat:h,log:d,flops:l});var n=Math.round(l/1000000)}},false);j.postMessage({cmd:"start"})};