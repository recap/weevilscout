var id="";var dtime=0;var cjobs=0;id=randomUUID();window.onbeforeunload=function(){if(id!=""){var a=new XMLHttpRequest();a.open("GET","cgi-bin/loader.cgi?cmd=end&id="+id,false);a.send(null)}};function getFunctionParamList(c){var b=/weevil_main[\s]*\([\w\,\s]+\)/;var f=/\([\w\,\s]+\)/;if(c.match(b)){var g=new String(c.match(b)[0]);var e=new String(g.match(f));var d=e.substr(1,e.length-2);var a=d.split(",");for(i=0;i<a.length;i++){a[i]=a[i].replace(/^\s+|\s+$/g,"")}return a}return[]}function getWeevilList(){var a=GetHttpRequest();var b;a.open("GET","cgi-bin/loader.cgi?cmd=getstore&id="+id,false);a.send(null);if(a.status==200){b=StringtoXML(a.responseText)}return b}function geolocFail(){success(null)}function joinWeevilNetwork(){try{if(navigator.geolocation){var c=setTimeout("geolocFail()",10000);navigator.geolocation.getCurrentPosition(function(e){clearTimeout(c);success(e)},function(e){clearTimeout(c);geolocFail()})}else{geolocFail()}}catch(d){geolocFail()}var f=new Worker("scripts/grabber.js");var b;var a=/^[-+]?\d+(\.\d+){1}$/;var g=/^[-+]?\d+$/;f.addEventListener("message",function(o){var r=StringtoXML(o.data);b=new Object();var m;var j;var q=r.getElementsByTagName("source")[0].childNodes[0].nodeValue;var h=r.getElementsByTagName("job-id")[0].childNodes[0].nodeValue;var l=r.getElementsByTagName("name")[0].childNodes[0].nodeValue;debug("tab1.bottom","[Info] Starting job: "+l);var n=r.getElementsByTagName("parameters")[0].childNodes;for(k=0;k<n.length;k++){if(!n[k].nodeName.match("#text")){if(n[k].firstChild.nodeValue.match(g)){b[n[k].nodeName]=parseInt(n[k].firstChild.nodeValue)}else{if(n[k].firstChild.nodeValue.match(a)){b[n[k].nodeName]=parseFloat(n[k].firstChild.nodeValue)}else{b[n[k].nodeName]=(n[k].firstChild.nodeValue!="null")?n[k].firstChild.nodeValue:null}}}}var p=new Worker(q);p.onerror=function(w){var u=w.filename.substring(w.filename.lastIndexOf("/")+1,w.filename.length-3);debug("tab1.bottom","[Error] In "+u);var v="cmd=submit&job_id="+encodeURIComponent(h)+"&job_name="+u+"&id="+encodeURIComponent(id)+"&status=3&result="+encodeURIComponent("[Error] "+w.message);var t=new GetHttpRequest();t.open("POST","cgi-bin/loader.cgi",false);t.setRequestHeader("Content-type","application/x-www-form-urlencoded");t.setRequestHeader("Content-length",n.length);t.setRequestHeader("Connection","close");t.send(v);f.postMessage({id:id});p.postMessage({cmd:"stop"});j=new Date();var s=Math.abs(j-m);dtime=dtime+s;swapDivText("tstate","Idling");swapDivText("dtime",(dtime/1000)+"s")};p.addEventListener("message",function(v){var u="cmd=submit&job_id="+encodeURIComponent(h)+"&job_name="+l+"&id="+encodeURIComponent(id)+"&status=2&result="+encodeURIComponent(v.data);var t=new GetHttpRequest();debug("tab1.bottom","[Info] Completed job: "+l);t.open("POST","cgi-bin/loader.cgi",false);t.setRequestHeader("Content-type","application/x-www-form-urlencoded");t.setRequestHeader("Content-length",n.length);t.setRequestHeader("Connection","close");debug("tab1.bottom","[Info] Submitted results for job: "+l);t.send(u);f.postMessage({id:id});p.postMessage({cmd:"stop"});j=new Date();var s=Math.abs(j-m);dtime=dtime+s;cjobs=cjobs+1;swapDivText("tstate","Idling");swapDivText("cjobs",cjobs);swapDivText("dtime",(dtime/1000)+"s")},false);b.cmd="start";m=new Date();p.postMessage(b);swapDivText("tstate","Working")},false);f.postMessage({id:id})}function enqueueWeevil(c){var a=GetHttpRequest();var b="cmd=enqueue&id="+id+"&weevil="+encodeURIComponent(c);a.open("POST","cgi-bin/loader.cgi",false);a.setRequestHeader("Content-type","application/x-www-form-urlencoded");a.setRequestHeader("Content-length",b.length);a.setRequestHeader("Connection","close");a.send(b);debug("tab2.bottom","[Info] Submitted job: "+document.getElementById("weevil_name").value)}function success(h){var n=-80;var g=0;if(h!=null){n=h.coords.latitude;g=h.coords.longitude}var f=[];var c=new google.maps.LatLng(35,14);var r={zoom:3,center:c,mapTypeControl:false,navigationControlOptions:{style:google.maps.NavigationControlStyle.SMALL},mapTypeId:google.maps.MapTypeId.ROADMAP};var d=new google.maps.Map(document.getElementById("content"),r);var p={gridSize:30,maxZoom:13};var o=null;debug("tab1.bottom","[Info] user id: "+id);var b=new Worker("scripts/heartbeat.js");var e=setInterval(j,30000);b.addEventListener("message",function(w){var v=StringtoXML(w.data);var u=v.getElementsByTagName("weevil");if(u.length>0){(function(){var D=[{key:"id",sortable:true,resizeable:true},{key:"name",sortable:true,resizeable:true},{key:"status",sortable:true,resizeable:true},{key:"queued time",formatter:YAHOO.widget.DataTable.formatDate,sortable:true,sortOptions:{defaultDir:YAHOO.widget.DataTable.CLASS_DESC},resizeable:true},{key:"duration",sortable:true,resizeable:true},{key:"results",sortable:false,resizeable:true}];var C=new Array();for(k=0;k<u.length;k++){var z=u[k].childNodes[0].nodeValue.split("##");var x="undefined";if(z[1]==0){x="queued"}if(z[1]==1){x="running"}if(z[1]==2){x="complete"}if(z[1]==3){x="error"}var B={};B.id="<a href=jobs/"+z[0]+".xml target='_blank'>"+z[0]+"</a>";B.name="<a href=jobs/"+z[2]+".js target='_blank'>"+z[2]+"</a>";B.status=x;B["queued time"]=z[3];B.duration=z[4];B.results="<a href=results/"+z[2]+"/"+z[0]+"_OUT.html target='_blank'>results</a>";C.push(B)}var A=new YAHOO.util.DataSource(C);A.responseType=YAHOO.util.DataSource.TYPE_JSARRAY;A.responseSchema={fields:["id","name","status","queued time","duration","results"]};var y=new YAHOO.widget.DataTable("tab3.center",D,A,{caption:"Weevil Stats"})})()}var t=v.getElementsByTagName("csize")[0].childNodes[0].nodeValue;swapDivText("csize",t);var s=v.getElementsByTagName("flops")[0].childNodes[0].nodeValue;swapDivText("flops",s);(function(){var y=v.getElementsByTagName("geop");var A=new Array();for(i=0;i<y.length;i++){var z=y[i].childNodes[0].nodeValue.split(":");var B=new google.maps.LatLng(z[0],z[1]);var x=new google.maps.Marker({position:B,title:z[2]});A.push(x)}if(o!=null){o.clearMarkers();o.addMarkers(A)}else{o=new MarkerClusterer(d,A,p)}})();v=null},false);function j(){b.postMessage({id:id,lat:n,log:g,flops:q})}var m=new Worker("scripts/flopsCalc-min.js");var a=0;var l=new Array();var q=0;m.addEventListener("message",function(s){l[a]=s.data.flops;a++;if(a<3){m.postMessage({cmd:"start"})}else{m.postMessage({cmd:"stop"});q=(l[0]+l[1]+l[2])/3;b.postMessage({id:id,lat:n,log:g,flops:q});var t=Math.round(q/1000000);debug("tab1.bottom","[Info] bogoflops: "+t+" Mflops")}},false);m.postMessage({cmd:"start"})};